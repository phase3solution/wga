<?php /* * Template Name: Scorecard */$data = advisory_get_scorecard_data($_GET['view']);$requestedPostType = get_post_type($_GET['view']);$removeHeaders = json_decode(ALL_RISKS);array_unshift($removeHeaders, 'bia');$tmp_fields = array(); get_header(); ?>    <div class="content-wrapper">        <?php if (!in_array($requestedPostType, $removeHeaders)) { ?>            <div class="row">                <div class="col-md-12">                    <div class="card">                        <div class="card-body text-center">                            <img src="<?php echo get_template_directory_uri() . '/images/scorecard-header.jpg'?>" class="img-responsive">                            <h4><?php _e('Published on: ' . get_the_date(get_option('date_format'), $_GET['view']), 'advisory') ?></h4>                        </div>                    </div>                </div>            </div>        <?php } ?>        <?php if ($requestedPostType == 'bia') {            echo '<div class="card bia-core">                <div class="card-body">                    <div class="row">                        <div class="text-center">                            <img src="' . get_template_directory_uri() . '/images/value-scorecard-bia.jpg" class="img-responsive">                            <h4>' . __('Published on: ' . get_the_date(get_option('date_format'), $_GET['view']), 'advisory') . '</h4>                        </div>                    </div><br><br>                    <div class="row">                        <div class="col-md-9">';                            foreach ($data as $area) {                                echo '<div class="table-responsive">                                    <table class="table table-bordered table-survey">                                        <thead>                                            <tr>                                                <th colspan="2"><strong class="font-120p">Department/Business Unit: ' . $area['name'] . '</strong></th>                                                <th class="no-padding"><div class="total-risk text-center ' . coloring_elements($area['total'] / count($area['services']), 'bia-score') . '"><strong>' . bia_level($area['total'] / count($area['services'])) . '</strong></div></th>                                            </tr>                                            <tr>                                                <th class="t-heading-dark">Service/Process</th>                                                <th class="t-heading-dark text-center">Calculated RTO</th>                                                <th class="t-heading-dark text-center">Criticality Level</th>                                            </tr>                                        </thead>                                        <tbody>';                                        if ($area['services']) {                                            foreach ($area['services'] as $service) {                                                echo '<tr>                                                    <td class="t-heading-sky min-w-340px">' . $service['name'] . '</td>                                                    <td>' . $service['rto'] . '</td>                                                    <td class="' . coloring_elements($service['cr'], 'bia-score') . '"></td>                                                </tr>';                                            }                                        }                                        echo '</tbody>                                    </table>                                </div>';                            }                        echo '</div>                        <div class="col-md-3">                            <p class="tr-dark score-padding"><strong>Criticality Level</strong></p>                            <div class="risk-bands">                                <span class="box-padding color-five"></span>&nbsp;&nbsp;                                <span><strong>Non-essential: 0-20</strong></span>                            </div>                            <div class="risk-bands">                                <span class="box-padding color-four"></span>&nbsp;&nbsp;                                <span><strong>Normal: 21-40</strong></span>                            </div>                            <div class="risk-bands">                                <span class="box-padding color-three"></span>&nbsp;&nbsp;                                <span><strong>Important: 41-60</strong></span>                            </div>                            <div class="risk-bands">                                <span class="box-padding color-two"></span>&nbsp;&nbsp;                                <span><strong>Urgent: 61-80</strong></span>                            </div>                            <div class="risk-bands">                                <span class="box-padding color-one"></span>&nbsp;&nbsp;                                <span><strong>Critical: Above 80</strong></span>                            </div>                        </div>                    </div>                </div>            </div>';        } elseif (in_array($requestedPostType, json_decode(ALL_RISKS))) {            // collect all avg            $avg = [];            $char_arr = [];            $char = 'A';            $tmp_threats = [];            foreach ($data as $area) {                $tmp_threats = array_merge($tmp_threats, (is_array($area['threats']) ? $area['threats'] : []));                if ($area['threats']) {                    foreach ($area['threats'] as $threat) {                        array_push($avg, $threat['avg']);                    }                    $avg = array_unique($avg);                    sort($avg);                }            }            foreach ($avg as $key => $value) {                $char_arr[$value] = $char;                $char++;            }            echo '<div class="row">                <div class="col-md-12">                    <div class="card">                        <div class="card-body">                            <div class="row">                                <div class="text-center">                                    <img src="' . get_template_directory_uri() . '/images/value-scorecard-risk.jpg" class="img-responsive">                                    <h4>' . __('Published on: ' . get_the_date(get_option('date_format'), $_GET['view']), 'advisory') . '</h4>                                </div>                            </div><br>                            <div class="row">                                <div class="col-sm-9">                                    <div class="score-table mb clearfix">                                        <ul>';                                            for ($i=0; $i < 17; $i++) {                                                echo '<li class="' . coloring_elements($i, 'risk-score') . '">                                                    <strong>' . $i . '</strong>                                                    ' . (array_key_exists($i, $char_arr) ? '<div class="score-list-value">(' . $char_arr[$i] . ')</div>' : '') . '                                                </li>';                                            }                                            echo '<li class="t-heading-dark">                                                <strong>Risk Heat Map</strong>                                            </li>                                        </ul>                                    </div>                                    <div class="score-rank-table">                                        <div class="table-responsive">                                            <table class="table table-bordered table-survey strong text-center">                                                <thead>                                                    <tr>                                                        <th style="font-size: 18px;font-weight: 700;" class="strong text-center">Letter</th>                                                        <th class="strong text-center">Threat (Category)</th>                                                        <th class="strong text-center">Rank</th>                                                    </tr>                                                </thead>                                                <tbody>';                                                    if ($tmp_threats) {                                                        usort($tmp_threats, 'advisory_tmp_threat_sort');                                                        foreach ($tmp_threats as $threat) {                                                            echo '<tr>                                                                <td>' . $char_arr[$threat['avg']] . '</td>                                                                <td>' . $threat['name'] . ' (' . $threat['cat'] . ')</td>                                                                <td><span class="box-padding ' . coloring_elements($threat['avg'], 'risk-score') . '"></span>&nbsp;&nbsp;' . $threat['avg'] . '</td>                                                            </tr>';                                                        }                                                    }                                                echo '</tbody>                                            </table>                                        </div>                                    </div>                                </div>                                <div class="col-sm-3">                                    <p class="tr-dark score-padding"><strong>Risk Bands</strong></p>                                    <div class="risk-bands">                                        <span class="box-padding color-five"></span>&nbsp;&nbsp;                                        <span><strong>Low: 0 - 3</strong></span>                                    </div>                                    <div class="risk-bands">                                        <span class="box-padding color-three"></span>&nbsp;&nbsp;                                        <span><strong>Medium: 4 - 8</strong></span>                                    </div>                                    <div class="risk-bands">                                        <span class="box-padding color-two"></span>&nbsp;&nbsp;                                        <span><strong>High: 9 - 12</strong></span>                                    </div>                                    <div class="risk-bands mb">                                        <span class="box-padding color-one"></span>&nbsp;&nbsp;                                        <span><strong>Extreme: 13 - 16</strong></span>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>';        } elseif ($requestedPostType == 'itsm') { ?>            <div class="row">                            <div class="col-md-9">                                <?php $html .= '<div class="table-responsive">                                    <table class="table table-bordered table-survey">                                        <tbody>';                                        foreach ($data as $key => $area) {                $loop = 0;                                                foreach ($area['sections'] as $section) {                                                    if ($loop == 0 || !empty(array_diff_key($tmp_fields, $section['fields']))) {                                                        $tmp_fields = $section['fields'];                                                        $colspan = (in_array($requestedPostType,                 array('itsm', 'cra')) ? 3 : count($section['fields']) + 2);                                                        $html .= '<tr><th class="t-heading-dark h3" colspan="' . $colspan . '">' . $area['name'] . '</th></tr>';                                                        if ($area['criteria'] == 'single') {                                                            $html .= '<tr><th class="t-heading-sky text-center">' . __('Section', 'advisory') . '</th><th class="t-heading-sky text-center">' . __('Description', 'advisory') . '</th>';                                                        } else {                                                            $html .= '<tr><th class="t-heading-sky">' . (empty($area['icon']) ? '' : '<img src="' . $area['icon'] . '" alt="">') . '</th>';                                                            /* foreach ($section['fields'] as $key => $field) {                                                                $html .= '<th class="t-heading-sky text-center">' . advisory_get_criteria_label($key) . '</th>';                                                            } */                                                        }                                                        $html .= '<th class="t-heading-sky text-center">Rating Level</th></tr>';                                    }                                    $loop++;                                                    $html .= '<tr>                                                        <td>' . $section['name'] . '</td>';                                                        /* if ($area['criteria'] == 'single') {                                                            $html .= '<td class="text-center">' . $section['desc'] . '</td>';                                                        } else {                                                            foreach ($section['fields'] as $field) {                                                                $html .= '<td class="text-center ' . coloring_elements(number_format($field, 1), 'avg') . '">' . ($field == 0 ? 'N/A' : number_format($field, 1)) . '</td>';                                            }                                                        } */                                                        $html .= '<td class="text-center ' . coloring_elements($section['avg'], 'avg') . '">' . $section['avg'] . '</td>                                                    </tr>';                                                }                                            }                                            $html .= '</tbody>                                        </table>                                    </div>';                                    echo $html; ?>                                </div>                                <div class="col-md-3">                                    <?php if ($requestedPostType == 'cra') { ?>                                        <div class="widget-small danger">                                            <div class="info text-center">                                                <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                                <p>Deficiencies have been identified that need immediate attention</p>                                            </div>                                        </div>                                        <div class="widget-small warning">                                            <div class="info text-center">                                                <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                                <p>Issues have identified that should be addressed prior to cloud migration</p>                                            </div>                                        </div>                                        <div class="widget-small success">                                            <div class="info text-center">                                                <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                                <p>No issues identified - Cloud Ready</p>                                            </div>                                        </div>                                    <?php } else { ?>                                        <div class="widget-small danger">                                            <div class="info text-center">                                                <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                                <p>Serious deficiencies have been identified that require attention within the next year</p>                                            </div>                                        </div>                                        <div class="widget-small warning">                                            <div class="info text-center">                                                <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                                <p>Deficiencies discovered that require attention within the next 2 years</p>                                            </div>                                        </div>                                        <div class="widget-small success">                                            <div class="info text-center">                                                <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                                <p>No deficiencies discovered</p>                                            </div>                                        </div>                                    <?php } ?>                                    <div class="text-center">                                        <a class="btn btn-primary btn-lg" href="javascript:window.print();"><i class="fa fa-lg fa-print"></i> Print</a>                                    </div>                                </div>                            </div>                        <?php                       }        elseif ($requestedPostType == 'drm') { ?>                        <div class="row">                            <div class="col-md-9">                                <?php $html .= '<div class="table-responsive">                                    <table class="table table-bordered table-survey">                                        <tbody>';                                        foreach ($data as $key => $area) {                $loop = 0;                                                foreach ($area['sections'] as $section) {                                                    if ($loop == 0 || !empty(array_diff_key($tmp_fields, $section['fields']))) {                                                        $tmp_fields = $section['fields'];                                                        $colspan = (in_array($requestedPostType,                 array('drm', 'cra')) ? 3 : count($section['fields']) + 2);                                                        $html .= '<tr><th class="t-heading-dark h3" colspan="' . $colspan . '">' . $area['name'] . '</th></tr>';                                                        if ($area['criteria'] == 'single') {                                                            $html .= '<tr><th class="t-heading-sky text-center">' . __('Section', 'advisory') . '</th><th class="t-heading-sky text-center">' . __('Description', 'advisory') . '</th>';                                                        } else {                                                            $html .= '<tr><th class="t-heading-sky">' . (empty($area['icon']) ? '' : '<img src="' . $area['icon'] . '" alt="">') . '</th>';                                                            /* foreach ($section['fields'] as $key => $field) {                                                                $html .= '<th class="t-heading-sky text-center">' . advisory_get_criteria_label($key) . '</th>';                                                            } */                                                        }                                                        $html .= '<th class="t-heading-sky text-center">Rating Level</th></tr>';                                    }                                    $loop++;                                                    $html .= '<tr>                                                        <td>' . $section['name'] . '</td>';                                                        /* if ($area['criteria'] == 'single') {                                                            $html .= '<td class="text-center">' . $section['desc'] . '</td>';                                                        } else {                                                            foreach ($section['fields'] as $field) {                                                                $html .= '<td class="text-center ' . coloring_elements(number_format($field, 1), 'avg') . '">' . ($field == 0 ? 'N/A' : number_format($field, 1)) . '</td>';                                            }                                                        } */                                                        $html .= '<td class="text-center ' . coloring_elements($section['avg'], 'avg') . '">' . $section['avg'] . '</td>                                                    </tr>';                                                }                                            }                                            $html .= '</tbody>                                        </table>                                    </div>';                                    echo $html; ?>                                </div>                                <div class="col-md-3">                                    <?php if ($requestedPostType == 'cra') { ?>                                        <div class="widget-small danger">                                            <div class="info text-center">                                                <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                                <p>Deficiencies have been identified that need immediate attention</p>                                            </div>                                        </div>                                        <div class="widget-small warning">                                            <div class="info text-center">                                                <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                                <p>Issues have identified that should be addressed prior to cloud migration</p>                                            </div>                                        </div>                                        <div class="widget-small success">                                            <div class="info text-center">                                                <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                                <p>No issues identified - Cloud Ready</p>                                            </div>                                        </div>                                    <?php } else { ?>                                        <div class="widget-small danger">                                            <div class="info text-center">                                                <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                                <p>Serious deficiencies have been identified that require attention within the next year</p>                                            </div>                                        </div>                                        <div class="widget-small warning">                                            <div class="info text-center">                                                <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                                <p>Deficiencies discovered that require attention within the next 2 years</p>                                            </div>                                        </div>                                        <div class="widget-small success">                                            <div class="info text-center">                                                <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                                <p>No deficiencies discovered</p>                                            </div>                                        </div>                                    <?php } ?>                                    <div class="text-center">                                        <a class="btn btn-primary btn-lg" href="javascript:window.print();"><i class="fa fa-lg fa-print"></i> Print</a>                                    </div>                                </div>                            </div>                        <?php                       }                           else { ?>                <div class="row">                    <div class="col-md-9">                        <?php $html .= '<div class="table-responsive">                            <table class="table table-bordered table-survey">                                <tbody>';                                foreach ($data as $key => $area) {                                    $loop = 0;                                    foreach ($area['sections'] as $section) {                                        if ($loop == 0 || !empty(array_diff_key($tmp_fields, $section['fields']))) {                                            $tmp_fields = $section['fields'];                                            $colspan = (in_array($requestedPostType, array('itsm', 'cra')) ? 3 : count($section['fields']) + 2);                                            $html .= '<tr><th class="t-heading-dark h3" colspan="' . $colspan . '">' . $area['name'] . '</th></tr>';                                            if ($area['criteria'] == 'single') {                                                $html .= '<tr><th class="t-heading-sky text-center">' . __('Section', 'advisory') . '</th><th class="t-heading-sky text-center">' . __('Description', 'advisory') . '</th>';                                            } else {                                                $html .= '<tr><th class="t-heading-sky">' . (empty($area['icon']) ? '' : '<img src="' . $area['icon'] . '" alt="">') . '</th>';                                                foreach ($section['fields'] as $key => $field) {                                                    $html .= '<th class="t-heading-sky text-center">' . advisory_get_criteria_label($key) . '</th>';                                                }                                            }                                            $html .= '<th class="t-heading-sky text-center">Rating Level</th></tr>';                                        }                                        $loop++;                                        $html .= '<tr>                                            <td>' . $section['name'] . '</td>';                                            if ($area['criteria'] == 'single') {                                                $html .= '<td class="text-center">' . $section['desc'] . '</td>';                                            } else {                                                foreach ($section['fields'] as $field) {                                                    $html .= '<td class="text-center ' . coloring_elements(number_format($field, 1), 'avg') . '">' . ($field == 0 ? 'N/A' : number_format($field, 1)) . '</td>';                                                }                                            }                                            $html .= '<td class="text-center ' . coloring_elements($section['avg'], 'avg') . '">' . $section['avg'] . '</td>                                        </tr>';                                    }                                }                                $html .= '</tbody>                            </table>                        </div>';                        echo $html; ?>                    </div>                    <div class="col-md-3">                        <?php if ($requestedPostType == 'cra') { ?>                            <div class="widget-small danger">                                <div class="info text-center">                                    <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                    <p>Deficiencies have been identified that need immediate attention</p>                                </div>                            </div>                            <div class="widget-small warning">                                <div class="info text-center">                                    <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                    <p>Issues have identified that should be addressed prior to cloud migration</p>                                </div>                            </div>                            <div class="widget-small success">                                <div class="info text-center">                                    <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                    <p>No issues identified - Cloud Ready</p>                                </div>                            </div>                        <?php } else { ?>                            <div class="widget-small danger">                                <div class="info text-center">                                    <h3><strong>CRITICAL</strong><br><small>(1 - 2.5)</small></h3>                                    <p>Serious deficiencies have been identified that require attention within the next year</p>                                </div>                            </div>                            <div class="widget-small warning">                                <div class="info text-center">                                    <h3><strong>MODERATE</strong><br><small>(2.6 - 3.5)</small></h3>                                    <p>Deficiencies discovered that require attention within the next 2 years</p>                                </div>                            </div>                            <div class="widget-small success">                                <div class="info text-center">                                    <h3><strong>PASS</strong><br><small>(3.6 -5.0)</small></h3>                                    <p>No deficiencies discovered</p>                                </div>                            </div>                        <?php } ?>                        <div class="text-center">                            <a class="btn btn-primary btn-lg" href="javascript:window.print();"><i class="fa fa-lg fa-print"></i> Print</a>                        </div>                    </div>                </div>        <?php } ?>    </div><?php get_footer(); ?>