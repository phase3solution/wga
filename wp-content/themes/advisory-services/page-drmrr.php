<?php /* Template Name: DR Maturity Risk Register */get_header();global $user_switching;if (current_user_can('administrator') || current_user_can('advisor') || $user_switching->get_old_user() || get_the_author_meta( 'specialbiauser', get_current_user_id()) ) {    $select_attr = '';    $save_btn = true;} else {	$select_attr = 'disabled';    $save_btn = false;} ?><div class="content-wrapper">	<div class="page-title">        <div>            <h1><img class="dashboardIcon" src="<?php echo get_template_directory_uri(); ?>/images/icon-drmrr.png" alt=""><?php _e('DR Maturity Register', 'advisory'); ?></h1>        </div>        <div>            <ul class="breadcrumb">                <li><i class="fa fa-home fa-lg"></i></li>                <li><a href="#"><?php _e('DR Maturity Register', 'advisory'); ?></a></li>            </ul>        </div>    </div>    <?php    $company_id = advisory_get_user_company_id();	if (advisory_metrics_in_progress($company_id, array('drmrr'))) {		$form_id = advisory_get_active_forms($company_id, array('drmrr'));	} else {		$id = new WP_Query([			'post_type' => 'drmrr',			'post_status' => 'archived',			'posts_per_page' => 1,			'meta_query' => [[				'key' => 'assigned_company',				'value' => $company_id,			]],			'fields' => 'ids',		]);		if ($id->found_posts > 0) {			$form_id = $id->posts;		}	}	if ($form_id[0]) {		$rr_data = advisory_get_formatted_drr_data($form_id[0]);	    foreach ($rr_data as $rr) {	    	if (@$_GET['cat'] != advisory_id_from_string($rr['cat'])) {	    		continue;	    	}	        $base = @number_format($rr['base']) * 1000;	        foreach ($rr['areas'] as $area) {	        	$base++;		        $rr_id = advisory_id_from_string($area['name']) . '_drmrr_registry';		        $default = advisory_company_default_values(advisory_get_user_company_id(), $rr_id);		        $avg = advisory_drm_avg_class_and_text($area['avg']);		        echo '<div class="row">		            <div class="col-md-12">		                <form class="form rr-form" method="post" data-meta="' . $rr_id . '" data-id="'. advisory_get_user_company_id() .'">		                    <div class="card">		                        <div class="card-title-w-btn">		                            <h4 class="title">Category: ' . $rr['cat'] . '<br>		                            <small>' . $base . ' : ' . $area['name'] . '</small></h4>';		                            if ($save_btn) {		                            	echo '<button class="btn btn-success" type="submit"><i class="fa fa-lg fa-floppy-o"></i> Save</button>';		                            }	                            echo '</div>		                        <div class="card-body">		                            <div class="table-responsive table-dynamic-registry">		                                <table class="table table-bordered table-survey mb-none">		                                    <thead>		                                        <tr>		                                            <th colspan="3" class="t-heading-dark font-120p"><strong>Description</big></th>		                                            <th colspan="2" class="t-heading-dark font-120p"><strong>Owner</big></th>		                                        </tr>		                                    </thead>		                                    <tbody>		                                        <tr>		                                            <td colspan="3" class="no-padding">		                                                <textarea name="desc" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['desc'].'</textarea>		                                            </td>		                                            <td colspan="2" class="no-padding">		                                                <textarea name="owner" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['owner'].'</textarea>		                                            </td>		                                        </tr>		                                    </tbody>		                                </table>		                                <table class="table table-bordered table-survey mb-0">		                                    <tbody>		                                        <tr>		                                            <th class="t-heading-l-dark font-120p">Last Assessment</th>		                                            <th class="t-heading-l-dark text-center font-120p">Rating</th>		                                            <th class="t-heading-l-dark text-center font-120p">Recommendation</th>		                                        </tr>		                                        <tr>		                                            <th class="no-padding" style="width:15%"><textarea name="last_assessment" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['last_assessment'].'</textarea></th>		                                            <td class="text-center font-14px '.$avg['cls'].' style="width:9%">'.$avg['text'].'</td>		                                            <td class="no-padding width-65p" style="width:76%">		                                                <textarea name="controls" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['controls'].'</textarea>		                                            </td>		                                        </tr>		                                    </tbody>		                                </table>		                                <table class="table table-bordered table-survey">		                                        <tr>		                                            <th colspan="2" class="t-heading-l-dark text-center font-120p">&nbsp;</th>		                                            <th colspan="2" class="t-heading-l-dark text-center font-120p">Notes</th>		                                            <th class="t-heading-l-dark text-center font-120p">Target</th>		                                        </tr>		                                        <tr>		                                            <th style="width: 12%" class="t-heading-ll-dark text-center">Target Start Date</th>		                                            <th style="width: 12%" class="t-heading-ll-dark text-center">Target End Date</th>		                                            <td colspan="2" style="width: 70%" rowspan="2" class="no-padding">		                                                <textarea name="notes" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['notes'].'</textarea>		                                            </td>		                                            <td style="width: 6%" rowspan="2" class="no-padding">		                                                '.  advisory_opt_select('target', '', 'invisible-opt fullHeightSelect', '', [1 => 'Optimizing', 2 => 'Measured', 3 => 'Defined', 4 => 'Managed', 5 => 'Initial'], @$default['target']) .'		                                            </td>		                                        </tr>		                                        <tr>		                                            <td class="no-padding">		                                                <textarea name="start" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['start'].'</textarea>		                                            </td>		                                            <td class="no-padding">		                                                <textarea name="end" class="form-control strong font-110p" ' . $select_attr . '>'.@$default['end'].'</textarea>		                                            </td>		                                        </tr>		                                    </tbody>		                                </table>		                            </div>		                        </div>		                    </div>		                </form>		            </div>		        </div>';	        }	    }	} else {		echo '<p>' . __('Register Not Available Yet') . '</p>';	} ?></div><?php get_footer(); ?>