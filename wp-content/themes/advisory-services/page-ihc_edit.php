<?php /* Template Name: IHC or MTA Edit */get_header();global $user_switching;$postType = !empty($_GET['p']) ? trim($_GET['p']) : 'ihc';if ($postType == 'mta') { $pageTitle = 'MTA Edit'; $pageIcon =  'icon-ihcr.png'; }else { $pageTitle = 'IHC Edit'; $pageIcon =  'icon-ihcr.png'; }// if (!current_user_can('administrator') || !current_user_can('advisor')) { exit('Not permited');} echo '<div class="content-wrapper">';	$postID = 0;    pageTitleAndBreadcrumb($pageTitle, $pageIcon);    $company_id = advisory_get_user_company_id();	if (advisory_metrics_in_progress($company_id, [$postType])) {		$form_id = advisory_get_active_forms($company_id, [$postType]);		$postID = $form_id[0];	}	if ($postID) {		if (isset($_POST['updateBtn'])) {			unset($_POST['updateBtn']);			update_post_meta($postID, 'form_opts', $_POST);			?><script>(function() { swal("Success", "Updated successfully.", "info") })</script><?php			echo '<div class="alert alert-success" role="alert">Updated successfully.<button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div>'; 			// $meta = $_POST;		}		$meta = get_post_meta($postID, 'form_opts', true);		$opts = [			'id' => 'form_opts',			'sections' => [				['name' => 'general', 	'title' => 'General', 	'fields' => advisoryGenerateIHCFormGeneral($meta)  ],				['name' => 'areas', 	'title' => 'Areas', 	'fields' => advisoryGenerateIHCFormAreas($meta)	   ],				['name' => 'sections', 	'title' => 'Sections', 	'fields' => advisoryGenerateIHCFormSections($meta) ],				['name' => 'tables', 	'title' => 'Tables', 	'fields' => advisoryGenerateIHCFormTables($meta)   ],				['name' => 'questions', 'title' => 'Questions', 'fields' => advisoryGenerateIHCFormQuestions($meta)]			]		];		$unique       = $opts['id'];    	$sections     = $opts['sections'];		$html = '';		if ($meta) {			$html = '<hr>';			$html .= '<form class="tabContainer" method="post">';			    $html .= '<div class="row">';			        $html .= renderTabNav($sections);			        $html .= '<div class="col-sm-9">';			            $html .= '<div class="tab-content card">';			                foreach ($sections as $sectionSI => $section) {			            		$active = $sectionSI == 0 ? 'active' : '';			                	$html .= '<div role="tabpanel" class="tab-pane '. $active .'" id="'. $section['name'] .'">';			                	$html .= renderTabContentFor($section['fields']);			                	$html .= '</div>';			            	}			            $html .= '</div>';			        $html .= '</div>';			    $html .= '</div>';			    $html .= '<button type="submit" name="updateBtn" class="btn btn-primary btn-lg">Update</button>';			$html .= '</form>';			echo $html;		}	} else {		echo '<p>' . __('Register Not Available Yet') . '</p>';	}echo '</div>';get_footer();